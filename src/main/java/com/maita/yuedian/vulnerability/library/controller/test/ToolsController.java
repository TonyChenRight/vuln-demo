package com.maita.yuedian.vulnerability.library.controller.test;

import com.maita.yuedian.vulnerability.library.context.UserContext;
import com.maita.yuedian.vulnerability.library.model.ImportResult;
import com.maita.yuedian.vulnerability.library.model.R;
import com.maita.yuedian.vulnerability.library.model.UserInfo;
import com.maita.yuedian.vulnerability.library.service.VuCnnvdService;
import com.maita.yuedian.vulnerability.library.service.VuCustomService;
import com.maita.yuedian.vulnerability.library.service.VuCveService;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.tags.Tag;
import jakarta.annotation.Resource;
import org.springframework.boot.autoconfigure.condition.ConditionalOnExpression;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

@Validated
@Tag(name = "测试工具接口")
@RequestMapping("/test/tools")
@RestController
@ConditionalOnExpression("!'${spring.profiles.active}'.contains('prd')")
public class ToolsController {

    @Resource
    private VuCnnvdService vuCnnvdService;
    @Resource
    private VuCveService vuCveService;
    @Resource
    private VuCustomService vuCustomService;

    @Operation(summary = "CNNVD--导入")
    @PostMapping(value = "/cnnvd/import", headers="content-type=multipart/form-data")
    public R<ImportResult> cnnvdImport(@RequestParam("file") @RequestPart("file") MultipartFile file) {
        UserInfo userInfo = new UserInfo();
        userInfo.setUserId(1L);
        userInfo.setName("admin");
        userInfo.setAccount("admin");
        userInfo.setRoleCode("admin");
        return vuCnnvdService.cnnvdImport(file, userInfo);
    }


    @Operation(summary = "Cve--导入")
    @PostMapping(value = "/cve/import", headers="content-type=multipart/form-data")
    public R<ImportResult> cveImport(@RequestParam("file") @RequestPart("file") MultipartFile file) {
        UserInfo userInfo = new UserInfo();
        userInfo.setUserId(1L);
        userInfo.setName("admin");
        userInfo.setAccount("admin");
        userInfo.setRoleCode("admin");
        return vuCveService.cveImport(file, userInfo);
    }

    @Operation(summary = "自定义--导入")
    @PostMapping(value = "/custom/import", headers="content-type=multipart/form-data")
    public R<ImportResult> customImport(@RequestParam("file") @RequestPart("file") MultipartFile file) {
        UserInfo userInfo = new UserInfo();
        userInfo.setUserId(1L);
        userInfo.setName("admin");
        userInfo.setAccount("admin");
        userInfo.setRoleCode("admin");
        return vuCustomService.customImport(file, userInfo);
    }
}