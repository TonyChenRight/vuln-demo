package com.maita.yuedian.vulnerability.library.domain;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableField;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import java.io.Serializable;

import com.maita.yuedian.vulnerability.library.model.UserInfo;
import com.maita.yuedian.vulnerability.library.model.cnnvd.CnnvdEditParam;
import com.maita.yuedian.vulnerability.library.model.cnnvd.CnnvdFileEntry;
import com.maita.yuedian.vulnerability.library.utils.FieldUtils;
import lombok.Getter;
import lombok.Setter;
import lombok.experimental.Accessors;

/**
 * <p>
 * CNNVD漏洞表
 * </p>
 *
 * @author jason
 * @since 2024-12-03
 */
@Getter
@Setter
@Accessors(chain = true)
@TableName("vu_cnnvd")
public class VuCnnvd implements Serializable {

    private static final long serialVersionUID = 1L;

    /**
     * ID
     */
    @TableId(value = "id", type = IdType.AUTO)
    private Long id;

    /**
     * 编号
     */
    @TableField("code")
    private String code;

    /**
     * 名称
     */
    @TableField("name")
    private String name;

    /**
     * 类型
     */
    @TableField("type")
    private String type;

    /**
     * 描述
     */
    @TableField("remark")
    private String remark;

    /**
     * 级别 1-低危 2-中危 3-高危 4-超危
     */
    @TableField("level")
    private Integer level;

    /**
     * 修复方式
     */
    @TableField("repair_methods")
    private String repairMethods;

    /**
     * 影响产品
     */
    @TableField("affect_product")
    private String affectProduct;

    /**
     * CVE编号
     */
    @TableField("cve_code")
    private String cveCode;

    /**
     * 发布时间
     */
    @TableField("publish_time")
    private Long publishTime;

    /**
     * 更新时间
     */
    @TableField("modify_time")
    private Long modifyTime;

    /**
     * 创建时间
     */
    @TableField("created_time")
    private Long createdTime;

    /**
     * 更新时间
     */
    @TableField("updated_time")
    private Long updatedTime;

    /**
     * 创建人ID
     */
    @TableField("creator_id")
    private Long creatorId;

    /**
     * 更新人ID
     */
    @TableField("updater_id")
    private Long updaterId;

    /**
     * 创建人名称
     */
    @TableField("creator_name")
    private String creatorName;

    /**
     * 更新人名称
     */
    @TableField("updater_name")
    private String updaterName;


    public static VuCnnvd buildForUpdate(VuCnnvd vuCnnvd, CnnvdFileEntry fileEntry, UserInfo userInfo) {
        FieldUtils.safeSet(fileEntry.getName(), vuCnnvd::setName);
        FieldUtils.safeSet(fileEntry.getCode(), vuCnnvd::setCode);
        FieldUtils.safeSet(fileEntry.getPublishTime(), vuCnnvd::setPublishTime);
        FieldUtils.safeSet(fileEntry.getModifyTime(), vuCnnvd::setModifyTime);
        FieldUtils.safeSet(fileEntry.getType(), vuCnnvd::setType);
        FieldUtils.safeSet(fileEntry.getLevel(), vuCnnvd::setLevel);
        FieldUtils.safeSet(fileEntry.getDesc(), vuCnnvd::setRemark);
        FieldUtils.safeSet(fileEntry.getCveCode(), vuCnnvd::setCveCode);
        vuCnnvd.setUpdatedTime(System.currentTimeMillis());
        vuCnnvd.setUpdaterId(userInfo.getUserId());
        return vuCnnvd;
    }

    public static VuCnnvd buildForManualUpdate(VuCnnvd vuCnnvd, CnnvdEditParam editParam, UserInfo userInfo) {
        FieldUtils.safeSet(editParam.getAffectProduct(), vuCnnvd::setAffectProduct);
        FieldUtils.safeSet(editParam.getRepairMethods(), vuCnnvd::setRepairMethods);
        vuCnnvd.setUpdatedTime(System.currentTimeMillis());
        vuCnnvd.setUpdaterId(userInfo.getUserId());
        return vuCnnvd;
    }


    public static VuCnnvd buildForInsert(CnnvdFileEntry fileEntry, UserInfo user) {
        VuCnnvd vuCnnvd = new VuCnnvd();
        FieldUtils.autoFill(fileEntry.getCode(), String.class, vuCnnvd::setCode);
        FieldUtils.autoFill(fileEntry.getName(), String.class, vuCnnvd::setName);
        FieldUtils.autoFill(fileEntry.getType(), String.class, vuCnnvd::setType);
        FieldUtils.autoFill(fileEntry.getDesc(), String.class, vuCnnvd::setRemark);
        FieldUtils.autoFill(fileEntry.getLevel(), Integer.class, vuCnnvd::setLevel);
        FieldUtils.autoFill(fileEntry.getCveCode(), String.class, vuCnnvd::setCveCode);
        FieldUtils.autoFill(fileEntry.getPublishTime(), Long.class, vuCnnvd::setPublishTime);
        FieldUtils.autoFill(fileEntry.getModifyTime(), Long.class, vuCnnvd::setModifyTime);

        vuCnnvd.setRepairMethods("");
        vuCnnvd.setAffectProduct("");
        long timeMillis = System.currentTimeMillis();
        vuCnnvd.setCreatedTime(timeMillis);
        vuCnnvd.setUpdatedTime(timeMillis);
        vuCnnvd.setCreatorId(user.getUserId());
        vuCnnvd.setUpdaterId(user.getUserId());
        vuCnnvd.setCreatorName(user.getName());
        vuCnnvd.setUpdaterName(user.getName());
        return vuCnnvd;
    }
}
